class BLayer extends HTMLElement{constructor(){super();this.currentLayer=null;this.fadeDuration=300;}
connectedCallback(){this.style.position='absolute';this.style.top='0';this.style.left='0';this.style.width='100%';this.style.height='100%';this.style.pointerEvents='none';this.style.zIndex=this.getAttribute('type')==='foreground'?'10':'1';this.pauseVideosIfReducedMotion(this);}
pauseVideosIfReducedMotion(container){const prefersReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches;if(prefersReducedMotion){const videos=container.querySelectorAll('video');videos.forEach(video=>{video.pause();});}}
async addLayer(html){return new Promise((resolve,reject)=>{try{if(this.currentLayer){this.fadeOut(this.currentLayer);}
const newLayer=document.createElement('div');newLayer.className='layer-content';newLayer.style.opacity='0';newLayer.style.transition=`opacity ${this.fadeDuration}ms ease-in-out`;newLayer.innerHTML=html;this.appendChild(newLayer);setTimeout(()=>{this.pauseVideosIfReducedMotion(newLayer);},0);if(window.ComponentLoader){window.ComponentLoader.find(newLayer).forEach(comp=>{window.ComponentLoader.load(comp).catch(()=>{});});}
requestAnimationFrame(()=>{newLayer.style.opacity='1';setTimeout(()=>{this.currentLayer=newLayer;resolve();},this.fadeDuration);});}catch(error){reject(error);}});}
fadeOut(layer){layer.style.opacity='0';setTimeout(()=>{if(layer.parentNode===this){this.removeChild(layer);}
if(this.currentLayer===layer){this.currentLayer=null;}},this.fadeDuration);}
clear(){const videos=this.querySelectorAll('video');videos.forEach(video=>{video.pause();video.currentTime=0;video.src='';video.load();});while(this.firstChild){this.removeChild(this.firstChild);}
this.currentLayer=null;}}
customElements.define('b-layer',BLayer);